/// <reference path="../typings/main.d.ts"/>
angular.module('starter.controllers')
    .controller('AudioMonitorCtrl', function ($scope, $stateParams, $log, $window, Settings, LumenStomp) {
    $scope.form = {};
    $scope.client = null;
    $scope.$on('$ionicView.enter', function () {
        LumenStomp.connect(function () {
            $scope.client = LumenStomp.getClient();
            // audio.out: AudioObject
            LumenStomp.subscribe('/topic/avatar.*.audio.out', function (exchange) {
                var msg = JSON.parse(exchange.body);
                $log.info("Received audio", msg.name, msg.contentType, msg.contentSize, 'bytes');
                document.getElementById('played').src = msg.contentUrl;
                $scope.replayPlayed();
            });
        });
    });
    $scope.$on('$ionicView.beforeLeave', function () {
        LumenStomp.disconnect();
    });
    // Audio
    $scope.replayPlayed = function () {
        var playedEl = document.getElementById('played');
        $log.info('Playing played ', playedEl, 'seconds ...');
        playedEl.play();
    };
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1ZGlvLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLDRDQUE0QztBQUM1QyxPQUFPLENBQUMsTUFBTSxDQUFDLHFCQUFxQixDQUFDO0tBRXBDLFVBQVUsQ0FBQyxrQkFBa0IsRUFBRSxVQUFTLE1BQU0sRUFBRSxZQUFZLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsVUFBVTtJQUM5RixNQUFNLENBQUMsSUFBSSxHQUFHLEVBQ2IsQ0FBQztJQUVGLE1BQU0sQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDO0lBQ3JCLE1BQU0sQ0FBQyxHQUFHLENBQUMsa0JBQWtCLEVBQUU7UUFDM0IsVUFBVSxDQUFDLE9BQU8sQ0FBQztZQUNmLE1BQU0sQ0FBQyxNQUFNLEdBQUcsVUFBVSxDQUFDLFNBQVMsRUFBRSxDQUFDO1lBQ3ZDLHlCQUF5QjtZQUN6QixVQUFVLENBQUMsU0FBUyxDQUFDLDJCQUEyQixFQUFFLFVBQVMsUUFBUTtnQkFDL0QsSUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ3BDLElBQUksQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsR0FBRyxDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsV0FBVyxFQUFFLEdBQUcsQ0FBQyxXQUFXLEVBQUUsT0FBTyxDQUFDLENBQUM7Z0JBQ2hGLFFBQVEsQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFzQixDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUMsVUFBVSxDQUFDO2dCQUM3RSxNQUFNLENBQUMsWUFBWSxFQUFFLENBQUM7WUFDMUIsQ0FBQyxDQUFDLENBQUM7UUFDUCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0lBQ0gsTUFBTSxDQUFDLEdBQUcsQ0FBQyx3QkFBd0IsRUFBRTtRQUNqQyxVQUFVLENBQUMsVUFBVSxFQUFFLENBQUM7SUFDNUIsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRO0lBQ1IsTUFBTSxDQUFDLFlBQVksR0FBRztRQUNsQixJQUFJLFFBQVEsR0FBRyxRQUFRLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBcUIsQ0FBQztRQUNyRSxJQUFJLENBQUMsSUFBSSxDQUFDLGlCQUFpQixFQUFFLFFBQVEsRUFBRSxhQUFhLENBQUMsQ0FBQztRQUN0RCxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDcEIsQ0FBQyxDQUFDO0FBRU4sQ0FBQyxDQUFDLENBQUMiLCJmaWxlIjoiYXVkaW8uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vdHlwaW5ncy9tYWluLmQudHNcIi8+XHJcbmFuZ3VsYXIubW9kdWxlKCdzdGFydGVyLmNvbnRyb2xsZXJzJylcclxuXHJcbi5jb250cm9sbGVyKCdBdWRpb01vbml0b3JDdHJsJywgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGVQYXJhbXMsICRsb2csICR3aW5kb3csIFNldHRpbmdzLCBMdW1lblN0b21wKSB7XHJcbiAgICAkc2NvcGUuZm9ybSA9IHtcclxuICAgIH07XHJcblxyXG4gICAgJHNjb3BlLmNsaWVudCA9IG51bGw7XHJcbiAgICAkc2NvcGUuJG9uKCckaW9uaWNWaWV3LmVudGVyJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgTHVtZW5TdG9tcC5jb25uZWN0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAkc2NvcGUuY2xpZW50ID0gTHVtZW5TdG9tcC5nZXRDbGllbnQoKTtcclxuICAgICAgICAgICAgLy8gYXVkaW8ub3V0OiBBdWRpb09iamVjdFxyXG4gICAgICAgICAgICBMdW1lblN0b21wLnN1YnNjcmliZSgnL3RvcGljL2F2YXRhci4qLmF1ZGlvLm91dCcsIGZ1bmN0aW9uKGV4Y2hhbmdlKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbXNnID0gSlNPTi5wYXJzZShleGNoYW5nZS5ib2R5KTtcclxuICAgICAgICAgICAgICAgICRsb2cuaW5mbyhcIlJlY2VpdmVkIGF1ZGlvXCIsIG1zZy5uYW1lLCBtc2cuY29udGVudFR5cGUsIG1zZy5jb250ZW50U2l6ZSwgJ2J5dGVzJyk7XHJcbiAgICAgICAgICAgICAgICAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BsYXllZCcpIGFzIEhUTUxNZWRpYUVsZW1lbnQpLnNyYyA9IG1zZy5jb250ZW50VXJsO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlcGxheVBsYXllZCgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG4gICAgJHNjb3BlLiRvbignJGlvbmljVmlldy5iZWZvcmVMZWF2ZScsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIEx1bWVuU3RvbXAuZGlzY29ubmVjdCgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gQXVkaW9cclxuICAgICRzY29wZS5yZXBsYXlQbGF5ZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgcGxheWVkRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGxheWVkJykgYXMgSFRNTE1lZGlhRWxlbWVudDtcclxuICAgICAgICAkbG9nLmluZm8oJ1BsYXlpbmcgcGxheWVkICcsIHBsYXllZEVsLCAnc2Vjb25kcyAuLi4nKTtcclxuICAgICAgICBwbGF5ZWRFbC5wbGF5KCk7XHJcbiAgICB9O1xyXG5cclxufSk7XHJcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
