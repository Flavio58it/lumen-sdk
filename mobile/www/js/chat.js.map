{"version":3,"sources":["chat.ts"],"names":[],"mappings":"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","file":"chat.js","sourcesContent":["/// <reference path=\"../typings/main.d.ts\"/>\r\n/* ----------- Ionic Elastichat: http://codepen.io/rossmartin/pen/XJmpQr ----------\r\nRequires bower packages:\r\n1. moment\r\n2. angular-moment\r\n3. angular-elastic\r\n4. Autolinker.js\r\n*/\r\n\r\ninterface ChatMessage {\r\n    _id?: string,\r\n    toId?: string,\r\n    text?: string,\r\n    date?: Date,\r\n    username?: string,\r\n    userId?: string,\r\n    pic?: string\r\n}\r\n\r\nclass MockService {\r\n    getUserMessages: any;\r\n    getMockMessage: any;\r\n}\r\n\r\nclass ChatUser {\r\n    _id: string;\r\n    name: string;\r\n    username: string;\r\n    pic: string;\r\n}\r\n\r\nclass Locale {\r\n    id: string;\r\n    name: string;\r\n}\r\n\r\nclass SocialChatCtrl {\r\n    public $inject = ['$scope', '$stateParams', '$log', \r\n        'LumenStomp', '$window', 'Settings',\r\n        '$rootScope', '$state', 'MockService',\r\n        '$ionicActionSheet',\r\n        '$ionicPopup', '$ionicScrollDelegate', '$timeout', '$interval'];\r\n        \r\n    messages: ChatMessage[];\r\n    form: any;\r\n    toUser: ChatUser;\r\n    user: ChatUser;\r\n    avatarIds: string[];\r\n    locales: Locale[];\r\n    /**\r\n     * queue of IDs of HTMLAudioElement to be played\r\n     */\r\n    audioQueue: string[];\r\n    client: any;\r\n    doneLoading: boolean;\r\n    txtInput: JQuery;\r\n    viewScroll: ionic.scroll.IonicScrollDelegate;\r\n    \r\n    constructor(public $scope: ng.IScope, public $stateParams: ng.ui.IStateParamsService, \r\n        public $log: ng.ILogService, \r\n        public LumenStomp, public $window: ng.IWindowService, public Settings,\r\n        public $rootScope: ng.IRootScopeService, public $state: ng.ui.IState, public MockService,\r\n        public $ionicActionSheet: ionic.actionSheet.IonicActionSheetService,\r\n        public $ionicPopup: ionic.popup.IonicPopupService,\r\n        public $ionicScrollDelegate: ionic.scroll.IonicScrollDelegate, \r\n        public $timeout: ng.ITimeoutService, public $interval: ng.IIntervalService) {\r\n    var vm = this;\r\n    this.messages = [];\r\n    this.toUser = {\r\n        _id: 'arkan',\r\n        name: 'Arkan Lumen',\r\n        username: 'Arkan Lumen',\r\n        pic: 'img/nao-128.png'};\r\n    this.user = {\r\n        _id: 'person',\r\n        name: 'You',\r\n        username: 'You',\r\n        pic: 'img/person-128.png'};\r\n    this.avatarIds = ['nao1', 'nao2',\r\n        'anime1', 'anime2', 'anime3', 'anime4', 'anime5', 'anime6', 'anime7', 'anime8', 'anime9', 'anime10'];\r\n    this.locales = [\r\n        {id: 'en-US', name: 'English (US)'},\r\n        {id: 'en-UK', name: 'English (UK)'},\r\n        {id: 'en-AU', name: 'English (Australia)'},\r\n        {id: 'id-ID', name: 'Indonesian'},\r\n        {id: 'ar-SA', name: 'Arabic'}\r\n    ];\r\n    this.form = {\r\n        avatarId: 'nao1',\r\n        audio: {\r\n            inLanguage: this.locales[3],\r\n            usedForChat: true,\r\n            muted: false\r\n        }\r\n    };\r\n    this.audioQueue = [];\r\n\r\n    var messageCheckTimer;\r\n\r\n    this.viewScroll = $ionicScrollDelegate.$getByHandle('userMessageScroll');\r\n    var footerBar; // gets set in $ionicView.enter\r\n    var scroller;\r\n    var audioQueueTimer;\r\n\r\n    $scope.$on('$ionicView.enter', () => {\r\n        this.$log.debug('UserMessages $ionicView.enter');\r\n\r\n        getMessages();\r\n\r\n        $timeout(() => {\r\n            footerBar = document.body.querySelector('#userMessagesView .bar-footer');\r\n            scroller = document.body.querySelector('#userMessagesView .scroll-content');\r\n            this.txtInput = angular.element(footerBar.querySelector('textarea'));\r\n        }, 0);\r\n\r\n        messageCheckTimer = $interval(() => {\r\n            // here you could check for new messages if your app doesn't use push notifications or user disabled them\r\n        }, 20000);\r\n\r\n        this.LumenStomp.connect(() => {\r\n            this.client = LumenStomp.getClient();\r\n            this.switchAvatar();\r\n        });\r\n\r\n        audioQueueTimer = $interval(() => {\r\n            if (this.audioQueue.length == 0) {\r\n                return;\r\n            }\r\n            //$log.debug('audioQueue:', vm.audioQueue);\r\n            var current = document.getElementById(this.audioQueue[0]) as HTMLMediaElement;\r\n            if (current.paused && !current.ended) {\r\n                this.$log.debug('Playing ', current, '...');\r\n                current.play();\r\n            } else if (current.ended) {\r\n                this.$log.debug('Finished playing', current);\r\n                this.audioQueue.shift();\r\n            }\r\n        }, 250);\r\n    });\r\n\r\n    $scope.$on('$ionicView.beforeLeave', () => {\r\n        this.$log.debug('leaving UserMessages view, destroying interval');\r\n        this.LumenStomp.disconnect();\r\n        // Make sure that the interval is destroyed\r\n        if (angular.isDefined(messageCheckTimer)) {\r\n            this.$interval.cancel(messageCheckTimer);\r\n            messageCheckTimer = undefined;\r\n        }\r\n        if (angular.isDefined(audioQueueTimer)) {\r\n            this.$interval.cancel(audioQueueTimer);\r\n            audioQueueTimer = undefined;\r\n        }\r\n    });\r\n\r\n    $scope.$on('$ionicView.beforeLeave', () => {\r\n      if (!this.form.message || this.form.message === '') {\r\n        //localStorage.removeItem('userMessage-' + this.toUser._id);\r\n      }\r\n    });\r\n\r\n    function getMessages() {\r\n      // the service is mock but you would probably pass the toUser's GUID here\r\n      MockService.getUserMessages({\r\n        toUserId: vm.toUser._id\r\n      }).then(function(data) {\r\n        vm.doneLoading = true;\r\n        vm.messages = data.messages;\r\n\r\n        $timeout(function() {\r\n          vm.viewScroll.scrollBottom();\r\n        }, 0);\r\n      });\r\n    }\r\n\r\n    $scope.$watch('input.message', (newValue, oldValue) => {\r\n      this.$log.debug('input.message $watch, newValue ' + newValue);\r\n      if (!newValue) newValue = '';\r\n      //localStorage['userMessage-' + vm.toUser._id] = newValue;\r\n    });\r\n\r\n    // I emit this event from the monospaced.elastic directive, read line 480\r\n    $scope.$on('elastic:resize', function(e, ta, oldHeight, newHeight) {\r\n      if (!ta) return;\r\n\r\n      var taHeight = newHeight; // ta[0].offsetHeight;\r\n      console.debug('taHeight:', taHeight);\r\n\r\n      if (!footerBar) return;\r\n\r\n      var newFooterHeight = taHeight + 10;\r\n      newFooterHeight = (newFooterHeight > 44) ? newFooterHeight : 44;\r\n\r\n      footerBar.style.height = newFooterHeight + 'px';\r\n      scroller.style.bottom = newFooterHeight + 'px';\r\n    });\r\n\r\n  }\r\n  \r\n    switchAvatar() {\r\n        this.LumenStomp.unsubscribeAll();\r\n        this.messages = [];\r\n        this.LumenStomp.subscribe('/topic/avatar.' + this.form.avatarId + '.chat.inbox', exchange => {\r\n            var communicateAction = JSON.parse(exchange.body);\r\n            this.$log.info(\"Received inbox\", communicateAction.object, communicateAction);\r\n\r\n            this.$log.debug('map', _.map(this.messages, function(m: ChatMessage) { return m._id; }));\r\n            var already = _.find(this.messages, function(m: ChatMessage) { return m._id == communicateAction['@id']; }) || false;\r\n            this.$log.debug('contains', typeof communicateAction['@id'] === 'undefined', communicateAction['@id'], already);\r\n            if ((typeof communicateAction['@id'] === 'undefined') || !already) {\r\n\r\n                // TODO: natively support CommunicateAction\r\n                communicateAction.toId = this.user._id;\r\n                communicateAction.text = communicateAction.object;\r\n                if (typeof communicateAction['@id'] === undefined) {\r\n                    communicateAction['@id'] = new Date().getTime(); // :~)\r\n                    communicateAction._id = new Date().getTime(); // :~)\r\n                }\r\n                communicateAction.date = new Date();\r\n                communicateAction.username = this.user.username;\r\n                communicateAction.userId = this.user._id;\r\n                communicateAction.pic = this.user.pic;\r\n\r\n                this.messages.push(communicateAction);\r\n            }\r\n\r\n            this.keepKeyboardOpen();\r\n            this.viewScroll.scrollBottom(true);\r\n        });\r\n        // avatar.{avatarId}.chat.outbox\r\n        this.LumenStomp.subscribe('/topic/avatar.' + this.form.avatarId + '.chat.outbox', exchange => {\r\n            var communicateAction = JSON.parse(exchange.body);\r\n            this.$log.info(\"Received outbox\", communicateAction.object, communicateAction);\r\n\r\n            // TODO: natively support CommunicateAction\r\n            communicateAction.toId = this.user._id;\r\n            communicateAction.text = communicateAction.object;\r\n            communicateAction['@id'] = communicateAction['@id'] || (new Date().getTime() + '_outbox'); // :~)\r\n            communicateAction._id = communicateAction['@id'];\r\n            communicateAction.date = new Date();\r\n            communicateAction.username = this.toUser.username;\r\n            communicateAction.userId = this.toUser._id;\r\n            communicateAction.pic = this.toUser.pic;\r\n\r\n            this.messages.push(communicateAction);\r\n            this.keepKeyboardOpen();\r\n            this.viewScroll.scrollBottom(true);\r\n\r\n            // has audio?\r\n            if (communicateAction.audio) {\r\n                var elId = 'audio_' + communicateAction['@id'];\r\n                //var playedEl = document.getElementById(elId);\r\n                if (!this.form.audio.muted) {\r\n                    this.$log.info('Queueing ', elId, '...');\r\n                    this.audioQueue.push(elId);\r\n                }\r\n                //playedEl.play();\r\n            }\r\n        });\r\n        // audio.out: AudioObject\r\n        this.LumenStomp.subscribe('/topic/avatar.*.audio.out', exchange => {\r\n            var msg = JSON.parse(exchange.body);\r\n            this.$log.info(\"Received audio\", msg.name, msg.contentType, msg.contentSize, 'bytes', msg);\r\n            var playedId = 'played';\r\n            var playedEl = document.getElementById(playedId) as HTMLMediaElement;\r\n            playedEl.src = msg.contentUrl;\r\n            //this.replayPlayed();\r\n            if (!this.form.audio.muted) {\r\n                this.$log.info('Queueing ', playedId, '...');\r\n                this.audioQueue.push(playedId);\r\n            }\r\n        });\r\n        this.$log.info('Subscriptions:', this.LumenStomp.getSubscriptions());\r\n    }\r\n    \r\n    sendMessage(sendMessageForm) {\r\n      var message: ChatMessage = {\r\n        toId: this.toUser._id as string,\r\n        text: this.form.message as string\r\n      };\r\n\r\n      // if you do a web service call this will be needed as well as before the viewScroll calls\r\n      // you can't see the effect of this in the browser it needs to be used on a real device\r\n      // for some reason the one time blur event is not firing in the browser but does on devices\r\n      this.keepKeyboardOpen();\r\n\r\n      //MockService.sendMessage(message).then(function(data) {\r\n      this.form.message = '';\r\n\r\n      message._id = 'chat:' + new Date().getTime(); // :~)\r\n      message['@id'] = message._id;\r\n      message.date = new Date();\r\n      message.username = this.user.username;\r\n      message.userId = this.user._id;\r\n      message.pic = this.user.pic;\r\n\r\n      this.messages.push(message);\r\n\r\n      var communicateAction = {\r\n        \"@type\": \"CommunicateAction\",\r\n        \"@id\": message._id,\r\n        \"object\": message.text,\r\n        \"inLanguage\": this.form.audio.inLanguage.id,\r\n        \"speechTruthValue\": [1.0, 1.0, 0] // to get speech synthesis for reply\r\n      };\r\n      this.client.send('/topic/avatar.' + this.form.avatarId + '.chat.inbox',\r\n                         {\"reply-to\": '/topic/avatar.' + this.form.avatarId + '.chat.inbox'},\r\n                         JSON.stringify(communicateAction));\r\n\r\n      this.$timeout(() => {\r\n        this.keepKeyboardOpen();\r\n        this.viewScroll.scrollBottom(true);\r\n      }, 0);\r\n\r\n      this.$timeout(() => {\r\n//        vm.messages.push(MockService.getMockMessage());\r\n        this.keepKeyboardOpen();\r\n        this.viewScroll.scrollBottom(true);\r\n      }, 2000);\r\n\r\n      //});\r\n    }\r\n\r\n    /**\r\n     * this keeps the keyboard open on a device only after sending a message, it is non obtrusive\r\n     */\r\n    keepKeyboardOpen() {\r\n        this.$log.debug('keepKeyboardOpen', this.txtInput);\r\n        this.txtInput.one('blur', () => {\r\n            this.$log.debug('textarea blur, focus back on it');\r\n            this.txtInput[0].focus();\r\n        });\r\n    }\r\n\r\n  onMessageHold(e, itemIndex, message) {\r\n      this.$log.debug('onMessageHold');\r\n      this.$log.debug('message: ' + JSON.stringify(message, null, 2));\r\n      this.$ionicActionSheet.show({\r\n        buttons: [{\r\n          text: 'Copy Text'\r\n        }, {\r\n          text: 'Delete Message'\r\n        }],\r\n        buttonClicked: function(index) {\r\n          switch (index) {\r\n            case 0: // Copy Text\r\n              //cordova.plugins.clipboard.copy(message.text);\r\n\r\n              break;\r\n            case 1: // Delete\r\n              // no server side secrets here :~)\r\n              this.messages.splice(itemIndex, 1);\r\n              this.$timeout(function() {\r\n                this.viewScroll.resize();\r\n              }, 0);\r\n\r\n              break;\r\n          }\r\n\r\n          return true;\r\n        }\r\n      });\r\n    }\r\n    \r\n    /**\r\n     * this prob seems weird here but I have reasons for this in my app, secret!\r\n     */\r\n    viewProfile(msg) {\r\n      if (msg.userId === this.user._id) {\r\n        // go to your profile\r\n      } else {\r\n        // go to other users profile\r\n      }\r\n    };\r\n\r\n    replayPlayed() {\r\n        var playedEl = document.getElementById('played') as HTMLMediaElement;\r\n        this.$log.info('Playing played ', playedEl, 'seconds ...');\r\n        playedEl.play();\r\n    }\r\n\r\n    sendRecordedMic() {\r\n        var recordedFileEl = document.getElementById('recordedMic') as HTMLInputElement;\r\n        var recordedFile = recordedFileEl.files[0];\r\n        this.$log.debug('Reading...', recordedFileEl, recordedFileEl.files, recordedFile, JSON.stringify(recordedFile));\r\n        var reader = new FileReader();\r\n        reader.onloadend = function() {\r\n            this.$scope.$apply(function() {\r\n                var audioObject = {\r\n                    '@type': 'AudioObject',\r\n                    inLanguage: this.form.audio.inLanguage.id,\r\n                    name: recordedFile.name,\r\n                    contentType: recordedFile.type,\r\n                    contentSize: recordedFile.size,\r\n                    dateModified: recordedFile.lastModifiedDate,\r\n                    contentUrl: reader.result,\r\n                    usedForChat: this.form.audio.usedForChat\r\n                };\r\n                this.$log.info('AudioObject', audioObject, JSON.stringify(audioObject));\r\n                this.client.send('/topic/avatar.' + this.form.avatarId + '.audio.in',\r\n                    {\"reply-to\": '/temp-queue/avatar.' + this.form.avatarId + '.audio.in'},\r\n                    JSON.stringify(audioObject));\r\n            });\r\n        };\r\n        reader.readAsDataURL(recordedFile);\r\n    };\r\n\r\n  toggleMuted() {\r\n      this.form.audio.muted = !this.form.audio.muted;\r\n  }\r\n}\r\n\r\nangular.module('starter.controllers')\r\n.controller('SocialChatCtrl', SocialChatCtrl)\r\n// services\r\n.factory('MockService', ['$http', '$q',\r\n  function($http: ng.IHttpService, $q: ng.IQService) {\r\n    var me = new MockService();\r\n\r\n    me.getUserMessages = function(d) {\r\n      /*\r\n      var endpoint =\r\n        'http://www.mocky.io/v2/547cf341501c337f0c9a63fd?callback=JSON_CALLBACK';\r\n      return $http.jsonp(endpoint).then(function(response) {\r\n        return response.data;\r\n      }, function(err) {\r\n        console.log('get user messages error, err: ' + JSON.stringify(\r\n          err, null, 2));\r\n      });\r\n      */\r\n      var deferred = $q.defer();\r\n\r\n\t\t setTimeout(function() {\r\n      \tdeferred.resolve(getMockMessages());\r\n\t    }, 1500);\r\n\r\n      return deferred.promise;\r\n    };\r\n\r\n    me.getMockMessage = function() {\r\n      return {\r\n        userId: '534b8e5aaa5e7afc1b23e69b',\r\n        date: new Date(),\r\n        text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.'\r\n      };\r\n    }\r\n\r\n    return me;\r\n  }\r\n])\r\n\r\n// fitlers\r\n.filter('nl2br', ['$filter',\r\n  function($filter) {\r\n    return function(data) {\r\n      if (!data) return data;\r\n      return data.replace(/\\n\\r?/g, '<br />');\r\n    };\r\n  }\r\n])\r\n\r\n// directives\r\n.directive('autolinker', ['$timeout',\r\n  function($timeout) {\r\n    return {\r\n      restrict: 'A',\r\n      link: function(scope, element, attrs) {\r\n        $timeout(function() {\r\n          var eleHtml = element.html();\r\n\r\n          if (eleHtml === '') {\r\n            return false;\r\n          }\r\n\r\n          var text = Autolinker.link(eleHtml, {\r\n            className: 'autolinker',\r\n            newWindow: false\r\n          });\r\n\r\n          element.html(text);\r\n\r\n          var autolinks = element[0].getElementsByClassName('autolinker');\r\n\r\n          for (var i = 0; i < autolinks.length; i++) {\r\n            angular.element(autolinks[i]).bind('click', function(e) {\r\n              var href = (e.target as HTMLAnchorElement).href;\r\n              console.log('autolinkClick, href: ' + href);\r\n\r\n              if (href) {\r\n                //window.open(href, '_system');\r\n                window.open(href, '_blank');\r\n              }\r\n\r\n              e.preventDefault();\r\n              return false;\r\n            });\r\n          }\r\n        }, 0);\r\n      }\r\n    }\r\n  }\r\n])\r\n\r\nfunction onProfilePicError(ele) {\r\n  this.ele.src = ''; // set a fallback\r\n}\r\n\r\nfunction getMockMessages() {\r\n  return {\"messages\": [], \"unread\": 0};\r\n//  mockMessages = {\"messages\":[\r\n//    {\"_id\":\"535d625f898df4e80e2a125e\",\"text\":\"Ionic has changed the game for hybrid app development.\",\"userId\":\"person\",\"date\":\"2014-04-27T20:02:39.082Z\",\"read\":true,\"readDate\":\"2014-12-01T06:27:37.944Z\"},\r\n//    {\"_id\":\"535f13ffee3b2a68112b9fc0\",\"text\":\"I like Ionic better than ice cream!\",\"userId\":\"arkan\",\"date\":\"2014-04-29T02:52:47.706Z\",\"read\":true,\"readDate\":\"2014-12-01T06:27:37.944Z\"},\r\n//    {\"_id\":\"546a5843fd4c5d581efa263a\",\"text\":\"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.\",\"userId\":\"person\",\"date\":\"2014-11-17T20:19:15.289Z\",\"read\":true,\"readDate\":\"2014-12-01T06:27:38.328Z\"},{\"_id\":\"54764399ab43d1d4113abfd1\",\"text\":\"Am I dreaming?\",\"userId\":\"arkan\",\"date\":\"2014-11-26T21:18:17.591Z\",\"read\":true,\"readDate\":\"2014-12-01T06:27:38.337Z\"},{\"_id\":\"547643aeab43d1d4113abfd2\",\"text\":\"Is this magic?\",\"userId\":\"person\",\"date\":\"2014-11-26T21:18:38.549Z\",\"read\":true,\"readDate\":\"2014-12-01T06:27:38.338Z\"},{\"_id\":\"547815dbab43d1d4113abfef\",\"text\":\"Gee wiz, this is something special.\",\"userId\":\"arkan\",\"date\":\"2014-11-28T06:27:40.001Z\",\"read\":true,\"readDate\":\"2014-12-01T06:27:38.338Z\"},{\"_id\":\"54781c69ab43d1d4113abff0\",\"text\":\"I think I like Ionic more than I like ice cream!\",\"userId\":\"person\",\"date\":\"2014-11-28T06:55:37.350Z\",\"read\":true,\"readDate\":\"2014-12-01T06:27:38.338Z\"},{\"_id\":\"54781ca4ab43d1d4113abff1\",\"text\":\"Yea, it's pretty sweet\",\"userId\":\"arkan\",\"date\":\"2014-11-28T06:56:36.472Z\",\"read\":true,\"readDate\":\"2014-12-01T06:27:38.338Z\"},\r\n//    {\"_id\":\"5478df86ab43d1d4113abff4\",\"text\":\"Wow, this is really something huh?\",\"userId\":\"person\",\"date\":\"2014-11-28T20:48:06.572Z\",\"read\":true,\"readDate\":\"2014-12-01T06:27:38.339Z\"},\r\n//    {\"_id\":\"54781ca4ab43d1d4113abff1\",\"text\":\"Create amazing apps - ionicframework.com\",\"userId\":\"arkan\",\"date\":\"2014-11-29T06:56:36.472Z\",\"read\":true,\"readDate\":\"2014-12-01T06:27:38.338Z\"}\r\n//    ],\"unread\":0};\r\n//  return mockMessages;\r\n}\r\n\r\n//import momentRef = require('moment');\r\n//declare var moment: moment.MomentStatic = momentRef;\r\ndeclare var moment: any;\r\n// configure moment relative time\r\nmoment.locale('en', {\r\n  relativeTime: {\r\n    future: \"in %s\",\r\n    past: \"%s ago\",\r\n    s: \"%d sec\",\r\n    m: \"a minute\",\r\n    mm: \"%d minutes\",\r\n    h: \"an hour\",\r\n    hh: \"%d hours\",\r\n    d: \"a day\",\r\n    dd: \"%d days\",\r\n    M: \"a month\",\r\n    MM: \"%d months\",\r\n    y: \"a year\",\r\n    yy: \"%d years\"\r\n  }\r\n});\r\n"],"sourceRoot":"/source/"}