{"version":3,"sources":["visual.ts"],"names":[],"mappings":"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","file":"visual.js","sourcesContent":["/// <reference path=\"../typings/main.d.ts\"/>\n/// <reference path=\"services.ts\"/>\n\nclass HumanDetected {\n    humanId: string;\n    position: any;\n    rotation: any;\n    imageU: number;\n    imageV: number;\n    imageVH: number;\n    cssStyle: Object;\n}\n\nangular.module('starter.controllers')\n\n.controller('VisualCameraCtrl', function($scope, $stateParams: ng.ui.IStateParamsService, \n        $log: ng.ILogService, Settings: Services.Settings, LumenStomp: Services.LumenStomp) {\n    $scope.imageObject = null;\n    $scope.bottomImageObject = null;\n    $scope.recognizeds = [];\n    $scope.client = null;\n    $scope.avatarIds = ['nao1', 'nao2',\n        'anime1', 'anime2', 'anime3', 'anime4', 'anime5', 'anime6', 'anime7', 'anime8', 'anime9', 'anime10'];\n    $scope.form = {\n        avatarId: 'nao1',\n        agentId: 'arkan'\n    };\n\n    // Avatar\n    $scope.switchAvatar = function() {\n        LumenStomp.unsubscribeAll();\n        $scope.imageObject = null;\n        $scope.bottomImageObject = null;\n        LumenStomp.subscribe('/topic/avatar.' + $scope.form.avatarId + '.camera.main', function(msg) {\n            var imageObject = JSON.parse(msg.body);\n            $scope.imageObject = imageObject;\n            $log.debug('Got main ImageObject', imageObject);\n        });\n        LumenStomp.subscribe('/topic/avatar.' + $scope.form.avatarId + '.camera.bottom', function(msg) {\n            var imageObject = JSON.parse(msg.body);\n            $scope.bottomImageObject = imageObject;\n            $log.debug('Got bottom ImageObject', imageObject);\n        });\n        LumenStomp.subscribe('/topic/lumen.' + $scope.form.agentId + '.face.recognition', function(msg) {\n            var recognized = JSON.parse(msg.body);\n            if (recognized.index == 0) {\n                $scope.recognizeds = [];\n            }\n            recognized.cssStyle = {\n                left: recognized.minPoint.x + 'px',\n                top: recognized.minPoint.y + 'px'\n            };\n            $scope.recognizeds.push(recognized);\n        });\n        $log.info('Subscriptions:', LumenStomp.getSubscriptions());\n    };\n\n    $scope.$on('$ionicView.enter', function() {\n        LumenStomp.connect(function() {\n            $scope.client = LumenStomp.getClient();\n            $scope.switchAvatar();\n        });\n    });\n    $scope.$on('$ionicView.beforeLeave', function() {\n        LumenStomp.disconnect();\n    });\n})\n\n.controller('ObjectRecognitionCtrl', function($scope, $stateParams: ng.ui.IStateParamsService, \n        $log: ng.ILogService, Settings: Services.Settings, LumenStomp: Services.LumenStomp) {\n    $scope.imageObject = null;\n    $scope.bottomImageObject = null;\n    $scope.recognizeds = [];\n    $scope.client = null;\n    $scope.avatarIds = ['nao1', 'nao2',\n        'anime1', 'anime2', 'anime3', 'anime4', 'anime5', 'anime6', 'anime7', 'anime8', 'anime9', 'anime10'];\n    $scope.form = {\n        avatarId: 'nao1',\n        agentId: 'arkan'\n    };\n\n    // Avatar\n    $scope.switchAvatar = function() {\n        LumenStomp.unsubscribeAll();\n        /*LumenStomp.subscribe('/topic/avatar.' + $scope.form.avatarId + '.camera.main', function(msg) {\n            var imageObject = JSON.parse(msg.body);\n            $scope.imageObject = imageObject;\n            $log.debug('Got main ImageObject', imageObject);\n        });\n        LumenStomp.subscribe('/topic/avatar.' + $scope.form.avatarId + '.camera.bottom', function(msg) {\n            var imageObject = JSON.parse(msg.body);\n            $scope.bottomImageObject = imageObject;\n            $log.debug('Got bottom ImageObject', imageObject);\n        });*/\n        LumenStomp.subscribe('/topic/lumen.visual.hogobj.recognition', function(msg) {\n            var recognizeds = JSON.parse(msg.body);\n\t\t\t$log.debug('Received RecognizedObjects', recognizeds);\n            $scope.recognizeds = recognizeds;\n        });\n        $log.info('Subscriptions:', LumenStomp.getSubscriptions());\n    };\n\n    $scope.$on('$ionicView.enter', function() {\n        LumenStomp.connect(function() {\n            $scope.client = LumenStomp.getClient();\n            $scope.switchAvatar();\n        });\n    });\n    $scope.$on('$ionicView.beforeLeave', function() {\n        LumenStomp.disconnect();\n    });\n\n\t$scope.sendMockRecognizedObjects = function() {\n\t\tvar recognizedObjects = {\n\t\t\t\"@type\": \"RecognizedObjects\",\n\t\t\t\"hasPosition\": true,\n\t\t\t\"hasDistance\": false,\n\t\t\t\"hasYaw\": false,\n\t\t\t\"trashes\": [\n\t\t\t\t{\n\t\t\t\t\t\"@type\": \"RecognizedObject\",\n\t\t\t\t\t\"topPosition\": {\"@type\": \"Vector2\", \"x\": 45, \"y\": 70},\n\t\t\t\t\t\"bottomPosition\": null\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"@type\": \"RecognizedObject\",\n\t\t\t\t\t\"topPosition\": null,\n\t\t\t\t\t\"bottomPosition\": {\"@type\": \"Vector2\", \"x\": 98, \"y\": 120}\n\t\t\t\t}\n\t\t\t],\n\t\t\t\"trashCans\": [\n\t\t\t\t{\n\t\t\t\t\t\"@type\": \"RecognizedObject\",\n\t\t\t\t\t\"topPosition\": null,\n\t\t\t\t\t\"bottomPosition\": {\"@type\": \"Vector2\", \"x\": 118, \"y\": 20}\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\t\t$log.debug('Sending RecognizedObjects', recognizedObjects);\n\t\t$scope.client.send('/topic/lumen.visual.hogobj.recognition',\n\t\t\t{}, JSON.stringify(recognizedObjects));\n\t};\n})\n\n.controller('FaceRecognitionImgCtrl', function($scope, $stateParams: ng.ui.IStateParamsService, \n        $log: ng.ILogService, LumenStomp: Services.LumenStomp, Settings: Services.Settings) {\n    $scope.imageObject = null;\n    $scope.recognizeds = [];\n\n    // Avatar\n    $scope.switchAvatar = function() {\n        LumenStomp.unsubscribeAll();\n        $scope.imageObject = null;\n        $scope.bottomImageObject = null;\n        LumenStomp.subscribe('/topic/lumen.arkan.face.recognition', function(msg) {\n            var recognized = JSON.parse(msg.body);\n            recognized.cssStyle = {\n                left: recognized.minPoint.x + 'px',\n                top: recognized.minPoint.y + 'px'\n            };\n            $scope.recognizeds.push(recognized);\n        });\n        $log.info('Subscriptions:', LumenStomp.getSubscriptions());\n    };\n    \n    $scope.$on('$ionicView.enter', function() {\n        LumenStomp.connect(function() {\n            $scope.client = LumenStomp.getClient();\n            $scope.switchAvatar();\n        });\n    });\n    $scope.$on('$ionicView.beforeLeave', function() {\n        LumenStomp.disconnect();\n    });\n    \n    $scope.testStomp = function() {\n        var imageObject = {\n            '@type': 'ImageObject',\n            name: 'wajah1_240p.jpg',\n            contentType: 'image/jpeg',\n            contentSize: 4880,\n            dateModified: \"2015-01-09T08:05:37.000Z\",\n            contentUrl: \"data:image/jpeg;base64,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Jx2Gee3rHw5kjl8G2csUiSI/mEMjBgf3jdxQBuUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAcl8dIrmf4W6nDaPseRoFZuPlQzx7zk8D5N3Jr588QaLaaJ4Fh0/T4/LtUdAhdyXnx/HjqRkn5m4ORjGa+ofE2mjV9Dn04yLH52352jEgXDBs7Twenfj69K4TxJ8Jv7W017IeIWto2kWQFLQszMpGC5MmW4zxwBnjHSgD5wgfyi0LHjqKZcBJJEkdfw9a9uvP2ehOc/wDCW7Txg/2b/wDbag/4ZzcqVbxrkf8AYK/+20AeLX2qLzHGGCjsDwPYVzHiK81eVRFZRTXB3cRqS2K+l4f2drZRiTxOHGQcDTsc/wDf2tiw+ClvZxlYNbjUsACwsOf/AEZQB8Xzv48gjMk2g3KRsCQSCTjpznn86xVi1C7uDNd28i7TzubpX3LqPwUmuoyq+KY489/7Myf/AEbXMal+zCl40jP4zVWk6kaR/wDbqAPljTxEIuADjpnvWhpMc1zcQQJBJI0kqxhYl3Eljj+hr6Hj/ZNij+746H46P/8Abq29H/ZuTTo4RB4xYPBcxXKSDTPm3qCDz5vQjt2PPNAHm+pbbLzry3kVRaK0dqy/8smb5A4HYiOLzPYsP71UvhfNMYbhYrdg0rj7NAMN+9k4jbnAISMKB6FvevbH+BMD2t1bnxH+7uN+xRYf6vcmzH+s5G3j8TRonwJTTb4Tx+JgY9jI8S6dtDAxhMf6zjkA/higDyPxsq6ZpyxwNJJGreTCY+WkQENNJ6ZkcbRnsOOrV9G/AaYXHwn0mYCAbhLlYBhFImcFR64xjPfGe9cnrXwSOpac9vN4mAlZhtl/s/7iBfugeZ/e+brznHvXoXw/0EeGPB1joQuEuPsaFfNSARK5LFs7ATjr60AbNFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQB//9k=\"\n        };\n        $log.info('ImageObject', imageObject, JSON.stringify(imageObject));\n        $scope.client.send('/topic/avatar.nao1.camera.main', {}, JSON.stringify(imageObject));\n    };\n    $scope.loadImage = function() {\n        $scope.recognizeds = [];\n        var imageFileEl = document.getElementById('imageFile') as HTMLInputElement;\n        // {\"webkitRelativePath\":\"\",\"lastModified\":1373040168000,\"lastModifiedDate\":\"2013-07-05T16:02:48.000Z\",\"name\":\"Sate Tegal Balibul3.jpg\",\"type\":\"image/jpeg\",\"size\":42082}\n        var imageFile = imageFileEl.files[0];\n        $log.debug('Reading...', imageFileEl, imageFileEl.files, imageFile, JSON.stringify(imageFile));\n        // ImageObject: name, contentType, contentUrl, contentSize, width, height, uploadDate, dateCreated, dateModified, datePublished\n        var reader = new FileReader();\n        reader.onloadend = function() {\n            $scope.$apply(function() {\n                $scope.imageObject = {\n                    '@type': 'ImageObject',\n                    name: imageFile.name,\n                    contentType: imageFile.type,\n                    contentSize: imageFile.size,\n                    dateModified: imageFile.lastModifiedDate,\n                    contentUrl: reader.result\n                };\n                $log.info('ImageObject', $scope.imageObject, JSON.stringify($scope.imageObject));\n            });\n        };\n        reader.readAsDataURL(imageFile);\n    };\n    $scope.recognize = function() {\n        $log.info('Recognizing...', $scope.imageObject, JSON.stringify($scope.imageObject));\n        $scope.client.send('/topic/avatar.nao1.camera.main', {}, JSON.stringify($scope.imageObject));\n    };\n})\n.controller('FaceRecognitionCamCtrl', function($scope, $stateParams: ng.ui.IStateParamsService, \n        $log: ng.ILogService, $interval: ng.IIntervalService, \n        LumenStomp: Services.LumenStomp, Settings: Services.Settings) {\n    $scope.imageObject = null;\n    $scope.recognizeds = [];\n    $scope.humanPos = {x: null, y: null, z: null};\n    $scope.markers = {};\n//    {\n//        position: {imageU: 10, imageV: 100, imageVH: 50},\n//        cssStyle: {left: '0px', top: '0px', height: '0px'}}];\n\n    // Avatar\n    $scope.switchAvatar = function() {\n        LumenStomp.unsubscribeAll();\n        LumenStomp.subscribe('/topic/lumen.arkan.face.recognition', function(msg) {\n            var recognized = JSON.parse(msg.body);\n            recognized.cssStyle = {\n                left: recognized.minPoint.x + 'px',\n                top: recognized.minPoint.y + 'px'\n            };\n            $scope.recognizeds.push(recognized);\n        });\n        LumenStomp.subscribe('/topic/lumen.arkan.human.detection', function(msg) {\n            var humanChanges = JSON.parse(msg.body);\n            var humanThings = humanChanges.humanDetecteds.concat(humanChanges.humanMovings) as HumanDetected[];\n            _.each(humanThings, function(e) {\n                $log.debug('human', e.humanId, 'pos', e.position);\n                $scope.humanPos = e.position;\n                $scope.markers[e.humanId] = e;\n                e.cssStyle = {\n                    left: (e.imageU-2) + 'px',\n                    top: (e.imageV - e.imageVH) + 'px',\n                    width: '5px',\n                    height: e.imageVH + 'px'\n                };\n            });\n        });\n        $log.info('Subscriptions:', LumenStomp.getSubscriptions());\n    };\n\n    $scope.$on('$ionicView.enter', function() {\n        LumenStomp.connect(function() {\n            $scope.client = LumenStomp.getClient();\n            $scope.switchAvatar();\n        });\n    });\n    $scope.$on('$ionicView.beforeLeave', function() {\n        LumenStomp.disconnect();\n    });\n\n    var imageContentType = 'image/jpeg'; // stomp.js can't handle big messages yet :(\n    var _video = null,\n        patData = null,\n        dataUri = null;\n    $scope.patOpts = {x: 0, y: 0, w: 320, h: 240};\n    $scope.streamingInterval = 1000;\n    $scope.streamer = null;\n\n    $scope.onStream = function(stream) {\n        // You could do something manually with the stream.\n        _video = document.querySelector('.webcam-live');\n        $log.debug('onStream', stream, _video);\n    };\n    $scope.onAccessDenied = function(err) {\n        $log.error('Webcam error:', err);\n    };\n    $scope.onStreaming = function() {\n        _video = document.querySelector('.webcam-live');\n        $log.debug('onStreaming', _video);\n        // The video element contains the captured camera data\n//        $scope.$apply(function() {\n//            $scope.patOpts.w = _video.width;\n//            $scope.patOpts.h = _video.height;\n//        });\n    };\n\n/* no longer used\n    var getVideoData = function getVideoData(x, y, w, h) {\n        var hiddenCanvas = document.createElement('canvas');\n        hiddenCanvas.width = $scope.patOpts.w;\n        hiddenCanvas.height = $scope.patOpts.h;\n        var ctx = hiddenCanvas.getContext('2d');\n        ctx.drawImage(_video, 0, 0, $scope.patOpts.w, $scope.patOpts.h);\n        return ctx.getImageData(x, y, w, h);\n    };\n    */\n\n    /**\n     * This function could be used to send the image data\n     * to a backend server that expects base64 encoded images.\n     *\n     * In this example, we simply store it in the scope for display.\n     */\n    var sendSnapshotToServer = function sendSnapshotToServer(imgBase64) {\n        $scope.snapshotData = imgBase64;\n    };\n\n    /**\n     * Make a snapshot of the camera data and show it in another canvas.\n     */\n    $scope.makeSnapshot = function makeSnapshot() {\n        if (_video) {\n            var patCanvas = document.querySelector('#snapshot') as HTMLCanvasElement;\n            if (!patCanvas) return;\n\n            patCanvas.width = $scope.patOpts.w;\n            patCanvas.height = $scope.patOpts.h;\n            var ctxPat = patCanvas.getContext('2d');\n\n//            var idata = getVideoData($scope.patOpts.x, $scope.patOpts.y, $scope.patOpts.w, $scope.patOpts.h);\n//            ctxPat.putImageData(idata, 0, 0);\n            ctxPat.drawImage(_video, 0, 0, $scope.patOpts.w, $scope.patOpts.h);\n            $log.info($scope.markers.length, 'markers', $scope.markers);\n            _.each($scope.markers as HumanDetected[], function(e, k) {\n                ctxPat.beginPath();\n                ctxPat.lineWidth = 8;\n                ctxPat.strokeStyle = '#00ff00';\n                ctxPat.moveTo(e.imageU, e.imageV);\n                ctxPat.lineTo(e.imageU, e.imageV - e.imageVH);\n                ctxPat.stroke();\n            });\n            var idata = ctxPat.getImageData($scope.patOpts.x, $scope.patOpts.y, $scope.patOpts.w, $scope.patOpts.h);\n\n            sendSnapshotToServer(patCanvas.toDataURL(imageContentType));\n\n            patData = idata;\n        }\n    };\n    $scope.recognize = function() {\n        if (!$scope.snapshotData) {\n            alert('No $scope.snapshotData!');\n            return;\n        }\n\n        $scope.imageObject = {\n            '@type': 'ImageObject',\n            name: 'camera.jpg',\n            contentType: imageContentType,\n            // TODO: contentSize: imageFile.size,\n            // TODO: dateModified: imageFile.lastModifiedDate,\n            contentUrl: $scope.snapshotData\n        };\n        $log.info('Recognizing...', $scope.imageObject, JSON.stringify($scope.imageObject));\n        $scope.client.send('/topic/avatar.nao1.camera.main', {}, JSON.stringify($scope.imageObject));\n//        window.alert('Sent: ' + JSON.stringify($scope.imageObject).substr(0, 300));\n    };\n    $scope.makeSnapshotAndRecognize = function() {\n        $scope.makeSnapshot();\n        $scope.recognize();\n    };\n\n    /**\n     * Redirect the browser to the URL given.\n     * Used to download the image by passing a dataURL string\n     */\n    $scope.downloadSnapshot = function downloadSnapshot(dataURL) {\n        window.location.href = dataURL;\n    };\n\n    $scope.startStreaming = function() {\n        $scope.streamer = $interval(function() {\n            $scope.makeSnapshotAndRecognize();\n        }, $scope.streamingInterval);\n    };\n    $scope.stopStreaming = function() {\n        $log.info('Canceling streamer');\n        $interval.cancel($scope.streamer);\n        $scope.streamer = null;\n    };\n})\n\n;\n"],"sourceRoot":"/source/"}