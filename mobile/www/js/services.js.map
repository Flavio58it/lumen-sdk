{"version":3,"sources":["services.ts"],"names":[],"mappings":"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","file":"services.js","sourcesContent":["/// <reference path=\"../typings/main.d.ts\"/>\n\nmodule Services {\n\n    export class Settings {\n        public defaultSettings = {\n            stompUri: 'ws://167.205.66.35:15674/ws',\n            stompUser: 'lumen',\n            stompPassword: 'lumen',\n            motionAllowed: false,\n        };\n\n        constructor(public $log: ng.ILogService, public $window: ng.IWindowService) {\n        }\n\n        getDefault() {\n            return this.defaultSettings;\n        }\n\n        getSettings() {\n            var settingsJson = this.$window.localStorage.getItem('settings');\n            var settings = settingsJson !== null ? JSON.parse(settingsJson) : this.defaultSettings;\n            return settings;\n        }\n\n        setSettings(settings) {\n            this.$window.localStorage.setItem('settings', JSON.stringify(settings));\n            return settings;\n        }\n    }\n    \n    export interface IExchange {\n        body: string\n    }\n\n    export class LumenStomp {\n        public client = null;\n        public subscriptions = [];\n\n        constructor(public $log: ng.ILogService, public $window: ng.IWindowService,\n            public Settings: Settings, public ngstomp) {\n        }\n\n        connect(callback: () => any) {\n            var settings = this.Settings.getSettings();\n            this.$log.info('Stomp connecting to', settings.stompUri);\n            this.client = this.ngstomp(settings.stompUri);\n            this.client.connect(settings.stompUser, settings.stompPassword, () => {\n                this.$log.info('Stomp connected to', settings.stompUri);\n                callback();\n            }, err => {\n                this.$log.error('Stomp error:', err);\n                this.client = null;\n            }, '/');\n        }\n\n        disconnect() {\n            this.unsubscribeAll();\n            if (this.client != null) {\n                this.$log.info('Disconnecting', this.client);\n                this.client.disconnect(function() { this.$log.info('Disconnected.'); });\n                this.client = null;\n            }\n        }\n\n        getClient() {\n            return this.client;\n        }\n\n        getSubscriptions() {\n            return this.subscriptions;\n        }\n\n        subscribe(topic: string, callback: (exchange: IExchange) => any) {\n            var sub = this.client.subscribe(topic, callback);\n            this.subscriptions.push(sub);\n            return sub;\n        }\n\n        unsubscribeAll() {\n            this.subscriptions.forEach(sub => {\n                this.$log.info('Unsubscribing', sub);\n                sub.unsubscribe();\n            });\n            this.subscriptions = [];\n        }\n    }\n\n}\n\nangular.module('starter.services', [])\n    .service('Settings', Services.Settings)\n    .service('LumenStomp', Services.LumenStomp);\n"],"sourceRoot":"/source/"}