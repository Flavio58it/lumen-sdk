{"version":3,"sources":["services.ts"],"names":[],"mappings":"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","file":"services.js","sourcesContent":["/// <reference path=\"../typings/main.d.ts\"/>\r\n\r\nclass Settings {\r\n    public defaultSettings = {\r\n        stompUri: 'ws://167.205.66.35:15674/ws',\r\n        stompUser: 'lumen',\r\n        stompPassword: 'lumen',\r\n        motionAllowed: false,\r\n    };\r\n\r\n    constructor(public $log: ng.ILogService, public $window: ng.IWindowService) {\r\n    }\r\n\r\n    getDefault() {\r\n        return this.defaultSettings;\r\n    }\r\n\r\n    getSettings() {\r\n        var settingsJson = this.$window.localStorage.getItem('settings');\r\n        var settings = settingsJson !== null ? JSON.parse(settingsJson) : this.defaultSettings;\r\n        return settings;\r\n    }\r\n\r\n    setSettings(settings) {\r\n        this.$window.localStorage.setItem('settings', JSON.stringify(settings));\r\n        return settings;\r\n    }\r\n}\r\n\r\nclass LumenStomp {\r\n    public client = null;\r\n    public subscriptions = [];\r\n    \r\n    constructor(public $log: ng.ILogService, public $window: ng.IWindowService, \r\n        public Settings: Settings, public ngstomp) {\r\n    }\r\n    \r\n    connect(callback: () => any) {\r\n        var settings = this.Settings.getSettings();\r\n        this.$log.info('Stomp connecting to', settings.stompUri);\r\n        this.client = this.ngstomp(settings.stompUri);\r\n        this.client.connect(settings.stompUser, settings.stompPassword, () => {\r\n            this.$log.info('Stomp connected to', settings.stompUri);\r\n            callback();\r\n        }, err => {\r\n            this.$log.error('Stomp error:', err);\r\n            this.client = null;\r\n        }, '/');\r\n    }\r\n    \r\n    disconnect() {\r\n        this.unsubscribeAll();\r\n        if (this.client != null) {\r\n            this.$log.info('Disconnecting', this.client);\r\n            this.client.disconnect(function() { this.$log.info('Disconnected.'); });\r\n            this.client = null;\r\n        }\r\n    }\r\n    \r\n    getClient() {\r\n        return this.client;\r\n    }\r\n    \r\n    getSubscriptions() {\r\n        return this.subscriptions;\r\n    }\r\n    \r\n    subscribe(topic, headers, body) {\r\n        var sub = this.client.subscribe(topic, headers, body);\r\n        this.subscriptions.push(sub);\r\n        return sub;\r\n    }\r\n    \r\n    unsubscribeAll() {\r\n        this.subscriptions.forEach(sub => {\r\n            this.$log.info('Unsubscribing', sub);\r\n            sub.unsubscribe();\r\n        });\r\n        this.subscriptions = [];\r\n    }\r\n}\r\n\r\nangular.module('starter.services', [])\r\n    .service('Settings', Settings)\r\n    .service('LumenStomp', LumenStomp);\r\n"],"sourceRoot":"/source/"}